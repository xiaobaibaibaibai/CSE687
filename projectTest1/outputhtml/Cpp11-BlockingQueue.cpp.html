<!Doctype html><head><style>body{padding: 15px 40px;font-family: Consolas;font-size: 1.25em;font-weight: normal;}</style></head><body><h3>Project #1 helper</h3><pre>
///////////////////////////////////////////////////////////////
// Cpp11-BlockingQueue.cpp - Thread-safe Blocking Queue      //
// ver 1.2                                                   //
// Jim Fawcett, CSE687 - Object Oriented Design, Spring 2013 //
///////////////////////////////////////////////////////////////

#include &ltcondition_variable&gt
#include &ltmutex&gt
#include &ltthread&gt
#include &ltqueue&gt
#include &ltstring&gt
#include &ltiostream&gt
#include &ltsstream&gt
#include "Cpp11-BlockingQueue.h"

#ifdef TEST_BLOCKINGQUEUE

std::mutex ioLock;

void test(BlockingQueue&ltstd::string&gt* pQ)
{
  std::string msg;
  do
  {
    msg = pQ-&gtdeQ();
    {
      std::lock_guard&ltstd::mutex&gt l(ioLock);
      std::cout &lt&lt "\n  thread deQed " &lt&lt msg.c_str();
    }
    std::this_thread::sleep_for(std::chrono::milliseconds(10));
  } while(msg != "quit");
}

int main()
{
  std::cout &lt&lt "\n  Demonstrating C++11 Blocking Queue";
  std::cout &lt&lt "\n ====================================";

  BlockingQueue&ltstd::string&gt q;
  std::thread t(test, &q);

  for(int i=0; i&lt15; ++i)
  {
    std::ostringstream temp;
    temp &lt&lt i;
    std::string msg = std::string("msg#") + temp.str();
    {
      std::lock_guard&ltstd::mutex&gt l(ioLock);
      std::cout &lt&lt "\n   main enQing " &lt&lt msg.c_str();
    }
    q.enQ(msg);
    std::this_thread::sleep_for(std::chrono::milliseconds(3));
  }
  q.enQ("quit");
  t.join();

  std::cout &lt&lt "\n";
  std::cout &lt&lt "\n  Making move copy of BlockingQueue";
  std::cout &lt&lt "\n -----------------------------------";

  std::string msg = "test";
  q.enQ(msg);
  std::cout &lt&lt "\n  before move:";
  std::cout &lt&lt "\n    q.size() = " &lt&lt q.size();
  std::cout &lt&lt "\n    q.front() = " &lt&lt q.front();
  BlockingQueue&ltstd::string&gt q2 = std::move(q);  // move assignment
  std::cout &lt&lt "\n  after move:";
  std::cout &lt&lt "\n    q2.size() = " &lt&lt q2.size();
  std::cout &lt&lt "\n    q.size() = " &lt&lt q.size();
  std::cout &lt&lt "\n    q2 element = " &lt&lt q2.deQ() &lt&lt "\n";

  std::cout &lt&lt "\n  Move assigning state of BlockingQueue";
  std::cout &lt&lt "\n ---------------------------------------";
  BlockingQueue&ltstd::string&gt q3;
  q.enQ("test");
  std::cout &lt&lt "\n  before move:";
  std::cout &lt&lt "\n    q.size() = " &lt&lt q.size();
  std::cout &lt&lt "\n    q.front() = " &lt&lt q.front();
  q3 = std::move(q);
  std::cout &lt&lt "\n  after move:";
  std::cout &lt&lt "\n    q.size() = " &lt&lt q.size();
  std::cout &lt&lt "\n    q3.size() = " &lt&lt q3.size();
  std::cout &lt&lt "\n    q3 element = " &lt&lt q3.deQ() &lt&lt "\n";

  std::cout &lt&lt "\n\n";
}

#endif
</pre></body></html>